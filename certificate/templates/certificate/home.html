{% extends 'certificate/base.html' %}

{% block title %}Repositorio de Certificados PDF de CENDITEL{% endblock %}

{% block content %}
<div align="center">
    <h1>Repositorio de Certificados Digitales</h1>
    <br />
    <form method="get" action="{% url 'busqueda' %}">
        {% csrf_token %}
        <div class="mb-3">
            <label for="cedula" class="form-label">
                <strong>Número de Cédula</strong>
            </label>
            <input
                type="text"
                class="form-control form-control-lg"
                id="cedula"
                name="q"
                placeholder="Ej: 12345678"
                value="{{ query|default:'' }}"
                required
                pattern="[0-9]+"
            >
            <div class="form-text">
                Ingrese su número de cédula sin puntos ni espacios.
            </div>
        </div>

        <div class="d-grid gap-2">
            <button type="submit" class="btn btn-primary btn-lg">
                <i class="fas fa-search"></i> Buscar Certificados
            </button>
        </div>
    </form>
    <br />
    {% if certificados %}
    <p><h4>Estás buscando la cédula o número de identificación: <strong>{{ query }}</strong></h4></p>
        <span class="certificados_encontrados"><h4>Certificados encontrados: {{ certificados|length }} certificado/s.</h4></span>
        <br />
        <br />
        <table class="table table-striped">
        <thead>
            <tr>
            <th><b>Nombre y Apellido</b></th>
            <th><b>Cédula o ID</b></th>
            <th><b>Evento / Curso</b></th>
            <th><b>Rol</b></th>
            <th><b>Fecha</b></th>
            <th><b>Ubicación electrónica</b></th>
            </tr>
        </thead>
        {% for x in certificados %}
        <tbody>
            <tr>
            <td>
                {{ x.nombre_completo }}
            </td>
            <td>
                {{ x.cedula }}
            </td>
            <td>
                {{ x.evento_curso }}
            </td>
            <td>
                {{ x.rol }}
            </td>
            <td>
                {{ x.uploaded_at | date:"d/m/y" }}
            </td>
            <td>
                <a href="media/{{ x.certificado }}" target="_blank">
                <button class="btn btn-default btn-grad-green">
                    <span class="glyphicon glyphicon-download-alt" aria-hidden="true"></span>
                    DESCARGAR
                </button>
                </a>
            </td>
            </tr>
        </tbody>
        {% endfor %}
        </table>
    {% else %}
        <!--p>Ningún certificado coincide con el criterio de búsqueda.</p-->
    {% endif %}
</div>
{% endblock %}
